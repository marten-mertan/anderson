;function JCSmartFilter(ajaxURL,viewMode,params){this.ajaxURL=ajaxURL;this.form=null;this.timer=null;this.cacheKey='';this.cache=[];this.popups=[];this.viewMode=viewMode;if(params&&params.SEF_SET_FILTER_URL){this.bindUrlToButton('set_filter',params.SEF_SET_FILTER_URL);this.sef=true;}if(params&&params.SEF_DEL_FILTER_URL){this.bindUrlToButton('del_filter',params.SEF_DEL_FILTER_URL);}}JCSmartFilter.prototype.keyup=function(input){if(!!this.timer){clearTimeout(this.timer);}this.timer=setTimeout(BX.delegate(function(){this.reload(input);},this),500);};JCSmartFilter.prototype.click=function(checkbox){if(!!this.timer){clearTimeout(this.timer);}this.timer=setTimeout(BX.delegate(function(){this.reload(checkbox);},this),500);};JCSmartFilter.prototype.reload=function(input){if(this.cacheKey!==''){if(!!this.timer){clearTimeout(this.timer);}this.timer=setTimeout(BX.delegate(function(){this.reload(input);},this),1000);return;}this.cacheKey='|';this.position=BX.pos(input,true);this.form=BX.findParent(input,{'tag':'form'});if(this.form){var values=[];values[0]={name:'ajax',value:'y'};this.gatherInputsValues(values,BX.findChildren(this.form,{'tag':new RegExp('^(input|select)$','i')},true));for(var i=0;i<values.length;i++)this.cacheKey+=values[i].name+':'+values[i].value+'|';if(this.cache[this.cacheKey]){this.curFilterinput=input;this.postHandler(this.cache[this.cacheKey],true);}else{if(this.sef){var set_filter=BX('set_filter');set_filter.disabled=true;}this.curFilterinput=input;BX.ajax.loadJSON(this.ajaxURL,this.values2post(values),BX.delegate(this.postHandler,this));}}};JCSmartFilter.prototype.updateItem=function(PID,arItem){if(arItem.PROPERTY_TYPE==='N'||arItem.PRICE){var trackBar=window['trackBar'+PID];if(!trackBar&&arItem.ENCODED_ID)trackBar=window['trackBar'+arItem.ENCODED_ID];if(trackBar&&arItem.VALUES){if(arItem.VALUES.MIN){if(arItem.VALUES.MIN.FILTERED_VALUE)trackBar.setMinFilteredValue(arItem.VALUES.MIN.FILTERED_VALUE);else
trackBar.setMinFilteredValue(arItem.VALUES.MIN.VALUE);}if(arItem.VALUES.MAX){if(arItem.VALUES.MAX.FILTERED_VALUE)trackBar.setMaxFilteredValue(arItem.VALUES.MAX.FILTERED_VALUE);else
trackBar.setMaxFilteredValue(arItem.VALUES.MAX.VALUE);}}}else if(arItem.VALUES){for(var i in arItem.VALUES){if(arItem.VALUES.hasOwnProperty(i)){var value=arItem.VALUES[i];var control=BX(value.CONTROL_ID);if(!!control){var label=document.querySelector('[data-role="label_'+value.CONTROL_ID+'"]');if(value.DISABLED){if(label)BX.addClass(label,'disabled');else
BX.addClass(control.parentNode,'disabled');}else{if(label)BX.removeClass(label,'disabled');else
BX.removeClass(control.parentNode,'disabled');}if(value.hasOwnProperty('ELEMENT_COUNT')){label=document.querySelector('[data-role="count_'+value.CONTROL_ID+'"]');if(label)label.innerHTML=value.ELEMENT_COUNT;}}}}}};JCSmartFilter.prototype.postHandler=function(result,fromCache){var hrefFILTER,url,curProp;var modef=BX('modef');var modef_num=BX('modef_num');if(!!result&&!!result.ITEMS){for(var popupId in this.popups){if(this.popups.hasOwnProperty(popupId)){this.popups[popupId].destroy();}}this.popups=[];for(var PID in result.ITEMS){if(result.ITEMS.hasOwnProperty(PID)){this.updateItem(PID,result.ITEMS[PID]);}}if(!!modef&&!!modef_num){modef_num.innerHTML=result.ELEMENT_COUNT;hrefFILTER=BX.findChildren(modef,{tag:'A'},true);if(result.FILTER_URL&&hrefFILTER){hrefFILTER[0].href=BX.util.htmlspecialcharsback(result.FILTER_URL);}if(result.FILTER_AJAX_URL&&result.COMPONENT_CONTAINER_ID){BX.unbindAll(hrefFILTER[0]);BX.bind(hrefFILTER[0],'click',function(e){url=BX.util.htmlspecialcharsback(result.FILTER_AJAX_URL);BX.ajax.insertToNode(url,result.COMPONENT_CONTAINER_ID);return BX.PreventDefault(e);});}if(result.INSTANT_RELOAD&&result.COMPONENT_CONTAINER_ID){url=BX.util.htmlspecialcharsback(result.FILTER_AJAX_URL);BX.ajax.insertToNode(url,result.COMPONENT_CONTAINER_ID);}else{if(modef.style.display==='none'){}if(this.viewMode=="VERTICAL"){curProp=BX.findChild(BX.findParent(this.curFilterinput,{'class':'bx-filter-parameters-box'}),{'class':'bx-filter-container-modef'},true,false);}if(result.SEF_SET_FILTER_URL){this.bindUrlToButton('set_filter',result.SEF_SET_FILTER_URL);reloadPage(result.SEF_SET_FILTER_URL);}}}}if(this.sef){var set_filter=BX('set_filter');set_filter.disabled=false;}if(!fromCache&&this.cacheKey!==''){this.cache[this.cacheKey]=result;}this.cacheKey='';};JCSmartFilter.prototype.bindUrlToButton=function(buttonId,url){var button=BX(buttonId);if(button){var proxy=function(j,func){return function(){return func(j);}};if(button.type=='submit')button.type='button';BX.bind(button,'click',proxy(url,function(url){window.location.href=url;return false;}));}};JCSmartFilter.prototype.gatherInputsValues=function(values,elements){if(elements){for(var i=0;i<elements.length;i++){var el=elements[i];if(el.disabled||!el.type)continue;switch(el.type.toLowerCase()){case'text':case'textarea':case'password':case'hidden':case'select-one':if(el.value.length)values[values.length]={name:el.name,value:el.value};break;case'radio':case'checkbox':if(el.checked)values[values.length]={name:el.name,value:el.value};break;case'select-multiple':for(var j=0;j<el.options.length;j++){if(el.options[j].selected)values[values.length]={name:el.name,value:el.options[j].value};}break;default:break;}}}};JCSmartFilter.prototype.values2post=function(values){var post=[];var current=post;var i=0;while(i<values.length){var p=values[i].name.indexOf('[');if(p==-1){current[values[i].name]=values[i].value;current=post;i++;}else{var name=values[i].name.substring(0,p);var rest=values[i].name.substring(p+1);if(!current[name])current[name]=[];var pp=rest.indexOf(']');if(pp==-1){current=post;i++;}else if(pp==0){current=current[name];values[i].name=''+current.length;}else{current=current[name];values[i].name=rest.substring(0,pp)+rest.substring(pp+1);}}}return post;};JCSmartFilter.prototype.hideFilterProps=function(element){var obj=element.parentNode,filterBlock=obj.querySelector("[data-role='bx_filter_block']"),propAngle=obj.querySelector("[data-role='prop_angle']");if(BX.hasClass(obj,"bx-active")){new BX.easing({duration:300,start:{opacity:1,height:filterBlock.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.transitions.quart,step:function(state){filterBlock.style.opacity=state.opacity;filterBlock.style.height=state.height+"px";},complete:function(){filterBlock.setAttribute("style","");BX.removeClass(obj,"bx-active");}}).animate();BX.addClass(propAngle,"fa-angle-down");BX.removeClass(propAngle,"fa-angle-up");}else{filterBlock.style.display="block";filterBlock.style.opacity=0;filterBlock.style.height="auto";var obj_children_height=filterBlock.offsetHeight;filterBlock.style.height=0;new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:1,height:obj_children_height},transition:BX.easing.transitions.quart,step:function(state){filterBlock.style.opacity=state.opacity;filterBlock.style.height=state.height+"px";},complete:function(){}}).animate();BX.addClass(obj,"bx-active");BX.removeClass(propAngle,"fa-angle-down");BX.addClass(propAngle,"fa-angle-up");}};JCSmartFilter.prototype.showDropDownPopup=function(element,popupId){var contentNode=element.querySelector('[data-role="dropdownContent"]');this.popups["smartFilterDropDown"+popupId]=BX.PopupWindowManager.create("smartFilterDropDown"+popupId,element,{autoHide:true,offsetLeft:0,offsetTop:3,overlay:false,draggable:{restrict:true},closeByEsc:true,content:BX.clone(contentNode)});this.popups["smartFilterDropDown"+popupId].show();};JCSmartFilter.prototype.selectDropDownItem=function(element,controlId){this.keyup(BX(controlId));var wrapContainer=BX.findParent(BX(controlId),{className:"bx-filter-select-container"},false);var currentOption=wrapContainer.querySelector('[data-role="currentOption"]');currentOption.innerHTML=element.innerHTML;BX.PopupWindowManager.getCurrentPopup().close();};BX.namespace("BX.Iblock.SmartFilter");BX.Iblock.SmartFilter=(function(){var SmartFilter=function(arParams){if(typeof arParams==='object'){this.leftSlider=BX(arParams.leftSlider);this.rightSlider=BX(arParams.rightSlider);this.tracker=BX(arParams.tracker);this.trackerWrap=BX(arParams.trackerWrap);this.minInput=BX(arParams.minInputId);this.maxInput=BX(arParams.maxInputId);this.minPrice=parseFloat(arParams.minPrice);this.maxPrice=parseFloat(arParams.maxPrice);this.curMinPrice=parseFloat(arParams.curMinPrice);this.curMaxPrice=parseFloat(arParams.curMaxPrice);this.fltMinPrice=arParams.fltMinPrice?parseFloat(arParams.fltMinPrice):parseFloat(arParams.curMinPrice);this.fltMaxPrice=arParams.fltMaxPrice?parseFloat(arParams.fltMaxPrice):parseFloat(arParams.curMaxPrice);this.precision=arParams.precision||0;this.priceDiff=this.maxPrice-this.minPrice;this.leftPercent=0;this.rightPercent=0;this.fltMinPercent=0;this.fltMaxPercent=0;this.colorUnavailableActive=BX(arParams.colorUnavailableActive);this.colorAvailableActive=BX(arParams.colorAvailableActive);this.colorAvailableInactive=BX(arParams.colorAvailableInactive);this.isTouch=false;this.init();if('ontouchstart'in document.documentElement){this.isTouch=true;BX.bind(this.leftSlider,"touchstart",BX.proxy(function(event){this.onMoveLeftSlider(event)},this));BX.bind(this.rightSlider,"touchstart",BX.proxy(function(event){this.onMoveRightSlider(event)},this));}else{BX.bind(this.leftSlider,"mousedown",BX.proxy(function(event){this.onMoveLeftSlider(event)},this));BX.bind(this.rightSlider,"mousedown",BX.proxy(function(event){this.onMoveRightSlider(event)},this));}BX.bind(this.minInput,"keyup",BX.proxy(function(event){this.onInputChange();},this));BX.bind(this.maxInput,"keyup",BX.proxy(function(event){this.onInputChange();},this));}};SmartFilter.prototype.init=function(){var priceDiff;if(this.curMinPrice>this.minPrice){priceDiff=this.curMinPrice-this.minPrice;this.leftPercent=(priceDiff*100)/this.priceDiff;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%";}this.setMinFilteredValue(this.fltMinPrice);if(this.curMaxPrice<this.maxPrice){priceDiff=this.maxPrice-this.curMaxPrice;this.rightPercent=(priceDiff*100)/this.priceDiff;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%";}this.setMaxFilteredValue(this.fltMaxPrice);};SmartFilter.prototype.setMinFilteredValue=function(fltMinPrice){this.fltMinPrice=parseFloat(fltMinPrice);if(this.fltMinPrice>=this.minPrice){var priceDiff=this.fltMinPrice-this.minPrice;this.fltMinPercent=(priceDiff*100)/this.priceDiff;if(this.leftPercent>this.fltMinPercent)this.colorAvailableActive.style.left=this.leftPercent+"%";else
this.colorAvailableActive.style.left=this.fltMinPercent+"%";this.colorAvailableInactive.style.left=this.fltMinPercent+"%";}else{this.colorAvailableActive.style.left="0%";this.colorAvailableInactive.style.left="0%";}};SmartFilter.prototype.setMaxFilteredValue=function(fltMaxPrice){this.fltMaxPrice=parseFloat(fltMaxPrice);if(this.fltMaxPrice<=this.maxPrice){var priceDiff=this.maxPrice-this.fltMaxPrice;this.fltMaxPercent=(priceDiff*100)/this.priceDiff;if(this.rightPercent>this.fltMaxPercent)this.colorAvailableActive.style.right=this.rightPercent+"%";else
this.colorAvailableActive.style.right=this.fltMaxPercent+"%";this.colorAvailableInactive.style.right=this.fltMaxPercent+"%";}else{this.colorAvailableActive.style.right="0%";this.colorAvailableInactive.style.right="0%";}};SmartFilter.prototype.getXCoord=function(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientLeft=docElem.clientLeft||body.clientLeft||0;var left=box.left+scrollLeft-clientLeft;return Math.round(left);};SmartFilter.prototype.getPageX=function(e){e=e||window.event;var pageX=null;if(this.isTouch&&event.targetTouches[0]!=null){pageX=e.targetTouches[0].pageX;}else if(e.pageX!=null){pageX=e.pageX;}else if(e.clientX!=null){var html=document.documentElement;var body=document.body;pageX=e.clientX+(html.scrollLeft||body&&body.scrollLeft||0);pageX-=html.clientLeft||0;}return pageX;};SmartFilter.prototype.recountMinPrice=function(){var newMinPrice=(this.priceDiff*this.leftPercent)/100;newMinPrice=(this.minPrice+newMinPrice).toFixed(this.precision);if(newMinPrice!=this.minPrice)this.minInput.value=newMinPrice;else
this.minInput.value="";smartFilter.keyup(this.minInput);};SmartFilter.prototype.recountMaxPrice=function(){var newMaxPrice=(this.priceDiff*this.rightPercent)/100;newMaxPrice=(this.maxPrice-newMaxPrice).toFixed(this.precision);if(newMaxPrice!=this.maxPrice)this.maxInput.value=newMaxPrice;else
this.maxInput.value="";smartFilter.keyup(this.maxInput);};SmartFilter.prototype.onInputChange=function(){var priceDiff;if(this.minInput.value){var leftInputValue=this.minInput.value;if(leftInputValue<this.minPrice)leftInputValue=this.minPrice;if(leftInputValue>this.maxPrice)leftInputValue=this.maxPrice;priceDiff=leftInputValue-this.minPrice;this.leftPercent=(priceDiff*100)/this.priceDiff;this.makeLeftSliderMove(false);}if(this.maxInput.value){var rightInputValue=this.maxInput.value;if(rightInputValue<this.minPrice)rightInputValue=this.minPrice;if(rightInputValue>this.maxPrice)rightInputValue=this.maxPrice;priceDiff=this.maxPrice-rightInputValue;this.rightPercent=(priceDiff*100)/this.priceDiff;this.makeRightSliderMove(false);}};SmartFilter.prototype.makeLeftSliderMove=function(recountPrice){recountPrice=(recountPrice!==false);this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%";var areBothSlidersMoving=false;if(this.leftPercent+this.rightPercent>=100){areBothSlidersMoving=true;this.rightPercent=100-this.leftPercent;this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%";}if(this.leftPercent>=this.fltMinPercent&&this.leftPercent<=(100-this.fltMaxPercent)){this.colorAvailableActive.style.left=this.leftPercent+"%";if(areBothSlidersMoving){this.colorAvailableActive.style.right=100-this.leftPercent+"%";}}else if(this.leftPercent<=this.fltMinPercent){this.colorAvailableActive.style.left=this.fltMinPercent+"%";if(areBothSlidersMoving){this.colorAvailableActive.style.right=100-this.fltMinPercent+"%";}}else if(this.leftPercent>=this.fltMaxPercent){this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%";if(areBothSlidersMoving){this.colorAvailableActive.style.right=this.fltMaxPercent+"%";}}if(recountPrice){this.recountMinPrice();if(areBothSlidersMoving)this.recountMaxPrice();}};SmartFilter.prototype.countNewLeft=function(event){var pageX=this.getPageX(event);var trackerXCoord=this.getXCoord(this.trackerWrap);var rightEdge=this.trackerWrap.offsetWidth;var newLeft=pageX-trackerXCoord;if(newLeft<0)newLeft=0;else if(newLeft>rightEdge)newLeft=rightEdge;return newLeft;};SmartFilter.prototype.onMoveLeftSlider=function(e){if(!this.isTouch){this.leftSlider.ondragstart=function(){return false;};}if(!this.isTouch){document.onmousemove=BX.proxy(function(event){this.leftPercent=((this.countNewLeft(event)*100)/this.trackerWrap.offsetWidth);this.makeLeftSliderMove();},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null;};}else{document.ontouchmove=BX.proxy(function(event){this.leftPercent=((this.countNewLeft(event)*100)/this.trackerWrap.offsetWidth);this.makeLeftSliderMove();},this);document.ontouchend=function(){document.ontouchmove=document.touchend=null;};}return false;};SmartFilter.prototype.makeRightSliderMove=function(recountPrice){recountPrice=(recountPrice!==false);this.rightSlider.style.right=this.rightPercent+"%";this.colorUnavailableActive.style.right=this.rightPercent+"%";var areBothSlidersMoving=false;if(this.leftPercent+this.rightPercent>=100){areBothSlidersMoving=true;this.leftPercent=100-this.rightPercent;this.leftSlider.style.left=this.leftPercent+"%";this.colorUnavailableActive.style.left=this.leftPercent+"%";}if((100-this.rightPercent)>=this.fltMinPercent&&this.rightPercent>=this.fltMaxPercent){this.colorAvailableActive.style.right=this.rightPercent+"%";if(areBothSlidersMoving){this.colorAvailableActive.style.left=100-this.rightPercent+"%";}}else if(this.rightPercent<=this.fltMaxPercent){this.colorAvailableActive.style.right=this.fltMaxPercent+"%";if(areBothSlidersMoving){this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%";}}else if((100-this.rightPercent)<=this.fltMinPercent){this.colorAvailableActive.style.right=100-this.fltMinPercent+"%";if(areBothSlidersMoving){this.colorAvailableActive.style.left=this.fltMinPercent+"%";}}if(recountPrice){this.recountMaxPrice();if(areBothSlidersMoving)this.recountMinPrice();}};SmartFilter.prototype.onMoveRightSlider=function(e){if(!this.isTouch){this.rightSlider.ondragstart=function(){return false;};}if(!this.isTouch){document.onmousemove=BX.proxy(function(event){this.rightPercent=100-(((this.countNewLeft(event))*100)/(this.trackerWrap.offsetWidth));this.makeRightSliderMove();},this);document.onmouseup=function(){document.onmousemove=document.onmouseup=null;};}else{document.ontouchmove=BX.proxy(function(event){this.rightPercent=100-(((this.countNewLeft(event))*100)/(this.trackerWrap.offsetWidth));this.makeRightSliderMove();},this);document.ontouchend=function(){document.ontouchmove=document.ontouchend=null;};}return false;};return SmartFilter;})();function reloadPage(url){var string='?ajax_submit=Y';$.ajax({url:url+string,success:function(res){BX('ajax_content').innerHTML=res;eval($("script",res).text());loadJs();}});};;(function(){'use strict';if(!!window.JCCatalogSectionComponent)return;window.JCCatalogSectionComponent=function(params){this.formPosting=false;this.siteId=params.siteId||'';this.ajaxId=params.ajaxId||'';this.template=params.template||'';this.componentPath=params.componentPath||'';this.parameters=params.parameters||'';if(params.navParams){this.navParams={NavNum:params.navParams.NavNum||1,NavPageNomer:parseInt(params.navParams.NavPageNomer)||1,NavPageCount:parseInt(params.navParams.NavPageCount)||1};}this.bigData=params.bigData||{enabled:false};this.container=document.querySelector('[data-entity="'+params.container+'"]');this.showMoreButton=null;this.showMoreButtonMessage=null;if(this.bigData.enabled&&BX.util.object_keys(this.bigData.rows).length>0){BX.cookie_prefix=this.bigData.js.cookiePrefix||'';BX.cookie_domain=this.bigData.js.cookieDomain||'';BX.current_server_time=this.bigData.js.serverTime;BX.ready(BX.delegate(this.bigDataLoad,this));}if(params.initiallyShowHeader){BX.ready(BX.delegate(this.showHeader,this));}if(params.deferredLoad){BX.ready(BX.delegate(this.deferredLoad,this));}if(params.lazyLoad){this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]');this.showMoreButtonMessage=this.showMoreButton.innerHTML;BX.bind(this.showMoreButton,'click',BX.proxy(this.showMore,this));}if(params.loadOnScroll){BX.bind(window,'scroll',BX.proxy(this.loadOnScroll,this));}};window.JCCatalogSectionComponent.prototype={checkButton:function(){if(this.showMoreButton){if(this.navParams.NavPageNomer==this.navParams.NavPageCount){BX.remove(this.showMoreButton);}else{this.container.appendChild(this.showMoreButton);}}},enableButton:function(){if(this.showMoreButton){BX.removeClass(this.showMoreButton,'disabled');this.showMoreButton.innerHTML=this.showMoreButtonMessage;}},disableButton:function(){if(this.showMoreButton){BX.addClass(this.showMoreButton,'disabled');this.showMoreButton.innerHTML=BX.message('BTN_MESSAGE_LAZY_LOAD_WAITER');}},loadOnScroll:function(){var scrollTop=BX.GetWindowScrollPos().scrollTop,containerBottom=BX.pos(this.container).bottom;if(scrollTop+window.innerHeight>containerBottom){this.showMore();}},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var data={};data['action']='showMore';data['PAGEN_'+this.navParams.NavNum]=this.navParams.NavPageNomer+1;if(!this.formPosting){this.formPosting=true;this.disableButton();this.sendRequest(data);}}},bigDataLoad:function(){var url='https://analytics.bitrix.info/crecoms/v1_0/recoms.php',data=BX.ajax.prepareData(this.bigData.params);if(data){url+=(url.indexOf('?')!==-1?'&':'?')+data;}var onReady=BX.delegate(function(result){this.sendRequest({action:'deferredLoad',bigData:'Y',items:result&&result.items||[],rid:result&&result.id,count:this.bigData.count,rowsRange:this.bigData.rowsRange,shownIds:this.bigData.shownIds});},this);BX.ajax({method:'GET',dataType:'json',url:url,timeout:3,onsuccess:onReady,onfailure:onReady});},deferredLoad:function(){this.sendRequest({action:'deferredLoad'});},sendRequest:function(data){var defaultData={siteId:this.siteId,template:this.template,parameters:this.parameters};if(this.ajaxId){defaultData.AJAX_ID=this.ajaxId;}BX.ajax({url:this.componentPath+'/ajax.php'+(document.location.href.indexOf('clear_cache=Y')!==-1?'?clear_cache=Y':''),method:'POST',dataType:'json',timeout:60,data:BX.merge(defaultData,data),onsuccess:BX.delegate(function(result){if(!result||!result.JS)return;BX.ajax.processScripts(BX.processHTML(result.JS).SCRIPT,false,BX.delegate(function(){this.showAction(result,data);},this));},this)});},showAction:function(result,data){if(!data)return;switch(data.action){case'showMore':this.processShowMoreAction(result);break;case'deferredLoad':this.processDeferredLoadAction(result,data.bigData==='Y');break;}},processShowMoreAction:function(result){this.formPosting=false;this.enableButton();if(result){this.navParams.NavPageNomer++;this.processItems(result.items);this.processPagination(result.pagination);this.checkButton();}},processDeferredLoadAction:function(result,bigData){if(!result)return;var position=bigData?this.bigData.rows:{};this.processItems(result.items,BX.util.array_keys(position));},processItems:function(itemsHtml,position){if(!itemsHtml)return;var processed=BX.processHTML(itemsHtml,false),temporaryNode=BX.create('DIV');var items,k,origRows;temporaryNode.innerHTML=processed.HTML;items=temporaryNode.querySelectorAll('[data-entity="items-row"]');if(items.length){this.showHeader(true);for(k in items){if(items.hasOwnProperty(k)){origRows=position?this.container.querySelectorAll('[data-entity="items-row"]'):false;items[k].style.opacity=0;if(origRows&&BX.type.isDomNode(origRows[position[k]])){origRows[position[k]].parentNode.insertBefore(items[k],origRows[position[k]]);}else{this.container.appendChild(items[k]);}}}new BX.easing({duration:2000,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(state){for(var k in items){if(items.hasOwnProperty(k)){items[k].style.opacity=state.opacity/100;}}},complete:function(){for(var k in items){if(items.hasOwnProperty(k)){items[k].removeAttribute('style');}}}}).animate();}BX.ajax.processScripts(processed.SCRIPT);},processPagination:function(paginationHtml){if(!paginationHtml)return;var pagination=document.querySelectorAll('[data-pagination-num="'+this.navParams.NavNum+'"]');for(var k in pagination){if(pagination.hasOwnProperty(k)){pagination[k].innerHTML=paginationHtml;}}},showHeader:function(animate){var parentNode=BX.findParent(this.container,{attr:{'data-entity':'parent-container'}}),header;if(parentNode&&BX.type.isDomNode(parentNode)){header=parentNode.querySelector('[data-entity="header"');if(header&&header.getAttribute('data-showed')!='true'){header.style.display='';if(animate){new BX.easing({duration:2000,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(state){header.style.opacity=state.opacity/100;},complete:function(){header.removeAttribute('style');header.setAttribute('data-showed','true');}}).animate();}else{header.style.opacity=100;}}}}};})();var $elem=$('.catalog-banner .cookie.animate-hide-show');function change(){$elem.each(function(i,el){setTimeout(function(){$elem.removeClass('hide');$(el).addClass('hide');},1000*i);});}change();setInterval(change,4000);;;(function(window){'use strict';if(window.JCCatalogItem)return;var BasketButton=function(params){BasketButton.superclass.constructor.apply(this,arguments);this.buttonNode=BX.create('span',{props:{className:'btn btn-default btn-buy btn-sm',id:this.id},style:typeof params.style==='object'?params.style:{},text:params.text,events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus");}};BX.extend(BasketButton,BX.PopupWindowButton);window.JCCatalogItem=function(arParams){this.lastQuantity={};this.version=1;this.ADMIN=arParams.ADMIN;this.dessert=false;this.folder=arParams.FOLDER;this.alcohol=arParams.ALCOHOL;this.productType=0;this.showQuantity=true;this.showAbsent=true;this.secondPict=false;this.showOldPrice=false;this.showMaxQuantity='N';this.relativeQuantityFactor=5;this.showPercent=false;this.showSkuProps=false;this.basketAction='ADD';this.showClosePopup=false;this.useCompare=false;this.showSubscription=false;this.visual={ID:'',PICT_ID:'',SECOND_PICT_ID:'',PICT_SLIDER_ID:'',QUANTITY_ID:'',QUANTITY_UP_ID:'',QUANTITY_DOWN_ID:'',PRICE_ID:'',PRICE_OLD_ID:'',DSC_PERC:'',SECOND_DSC_PERC:'',DISPLAY_PROP_DIV:'',BASKET_PROP_DIV:'',SUBSCRIBE_ID:''};this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,isDblQuantity:false,canBuy:true,name:'',pict:{},id:0,addUrl:'',buyUrl:''};this.basketMode='';this.basketData={useProps:false,emptyProps:false,quantity:'quantity',props:'prop',basketUrl:'',sku_props:'',sku_props_var:'basket_props',add_url:'',buy_url:''};this.compareData={compareUrl:'',compareDeleteUrl:'',comparePath:''};this.defaultPict={pict:null,secondPict:null};this.defaultSliderOptions={interval:3000,wrap:true};this.slider={options:{},items:[],active:null,sliding:null,paused:null,interval:null,progress:null};this.touch=null;this.checkQuantity=false;this.maxQuantity=0;this.minQuantity=0;this.stepQuantity=1;this.isDblQuantity=false;this.canBuy=true;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.bigData=false;this.fullDisplayMode=false;this.viewMode='';this.templateTheme='';this.currentPriceMode='';this.currentPrices=[];this.currentPriceSelected=0;this.currentQuantityRanges=[];this.currentQuantityRangeSelected=0;this.offers=[];this.offerNum=0;this.treeProps=[];this.selectedValues={};this.obProduct=null;this.blockNodes={};this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obQuantityLimit={};this.obPict=null;this.obSecondPict=null;this.obPictSlider=null;this.obPictSliderIndicator=null;this.obPrice=null;this.obTree=null;this.obBuyBtn=null;this.obBasketActions=null;this.obNotAvail=null;this.obSubscribe=null;this.obDscPerc=null;this.obSecondDscPerc=null;this.obSkuProps=null;this.obMeasure=null;this.obCompare=null;this.obPopupWin=null;this.basketUrl='';this.basketParams={};this.isTouchDevice=BX.hasClass(document.documentElement,'bx-touch');this.hoverTimer=null;this.hoverStateChangeForbidden=false;this.mouseX=null;this.mouseY=null;this.useEnhancedEcommerce=false;this.dataLayerName='dataLayer';this.brandProperty=false;this.errorCode=0;if(typeof arParams==='object'){if(arParams.PRODUCT_TYPE){this.productType=parseInt(arParams.PRODUCT_TYPE,10);}this.showQuantity=arParams.SHOW_QUANTITY;this.showAbsent=arParams.SHOW_ABSENT;this.secondPict=arParams.SECOND_PICT;this.showOldPrice=arParams.SHOW_OLD_PRICE;this.showMaxQuantity=arParams.SHOW_MAX_QUANTITY;this.relativeQuantityFactor=parseInt(arParams.RELATIVE_QUANTITY_FACTOR);this.showPercent=arParams.SHOW_DISCOUNT_PERCENT;this.showSkuProps=arParams.SHOW_SKU_PROPS;this.showSubscription=arParams.USE_SUBSCRIBE;if(arParams.ADD_TO_BASKET_ACTION){this.basketAction=arParams.ADD_TO_BASKET_ACTION;}this.showClosePopup=arParams.SHOW_CLOSE_POPUP;this.useCompare=arParams.DISPLAY_COMPARE;this.fullDisplayMode=arParams.PRODUCT_DISPLAY_MODE==='Y';this.bigData=arParams.BIG_DATA;this.viewMode=arParams.VIEW_MODE||'';this.templateTheme=arParams.TEMPLATE_THEME||'';this.useEnhancedEcommerce=arParams.USE_ENHANCED_ECOMMERCE==='Y';this.dataLayerName=arParams.DATA_LAYER_NAME;this.brandProperty=arParams.BRAND_PROPERTY;this.show_element=arParams.SHOW_ELEMENT;this.visual=arParams.VISUAL;switch(this.productType){case 0:case 1:case 2:if(arParams.PRODUCT&&typeof arParams.PRODUCT==='object'){this.currentPriceMode=arParams.PRODUCT.ITEM_PRICE_MODE;this.currentPrices=arParams.PRODUCT.ITEM_PRICES;this.currentPriceSelected=arParams.PRODUCT.ITEM_PRICE_SELECTED;this.currentQuantityRanges=arParams.PRODUCT.ITEM_QUANTITY_RANGES;this.currentQuantityRangeSelected=arParams.PRODUCT.ITEM_QUANTITY_RANGE_SELECTED;if(this.showQuantity){this.product.checkQuantity=arParams.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=arParams.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=(this.product.isDblQuantity?parseFloat(arParams.PRODUCT.MAX_QUANTITY):parseInt(arParams.PRODUCT.MAX_QUANTITY,10));}this.product.stepQuantity=(this.product.isDblQuantity?parseFloat(arParams.PRODUCT.STEP_QUANTITY):parseInt(arParams.PRODUCT.STEP_QUANTITY,10));this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.stepQuantity=this.product.stepQuantity;this.maxQuantity=this.product.maxQuantity;this.minQuantity=this.currentPriceMode==='Q'?parseFloat(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor;}}this.product.canBuy=arParams.PRODUCT.CAN_BUY;if(arParams.PRODUCT.MORE_PHOTO_COUNT){this.product.morePhotoCount=arParams.PRODUCT.MORE_PHOTO_COUNT;this.product.morePhoto=arParams.PRODUCT.MORE_PHOTO;}if(arParams.PRODUCT.RCM_ID){this.product.rcmId=arParams.PRODUCT.RCM_ID;}this.canBuy=this.product.canBuy;this.product.name=arParams.PRODUCT.NAME;this.product.pict=arParams.PRODUCT.PICT;this.product.id=arParams.PRODUCT.ID;this.product.DETAIL_PAGE_URL=arParams.PRODUCT.DETAIL_PAGE_URL;this.product.category=arParams.PRODUCT.CATEGORY;if(arParams.PRODUCT.ADD_URL){this.product.addUrl=arParams.PRODUCT.ADD_URL;}if(arParams.PRODUCT.BUY_URL){this.product.buyUrl=arParams.PRODUCT.BUY_URL;}if(arParams.BASKET&&typeof arParams.BASKET==='object'){this.basketData.useProps=arParams.BASKET.ADD_PROPS;this.basketData.emptyProps=arParams.BASKET.EMPTY_PROPS;}}else{this.errorCode=-1;}break;case 3:if(arParams.PRODUCT&&typeof arParams.PRODUCT==='object'){this.product.name=arParams.PRODUCT.NAME;this.product.id=arParams.PRODUCT.ID;this.product.DETAIL_PAGE_URL=arParams.PRODUCT.DETAIL_PAGE_URL;this.product.morePhotoCount=arParams.PRODUCT.MORE_PHOTO_COUNT;this.product.morePhoto=arParams.PRODUCT.MORE_PHOTO;if(arParams.PRODUCT.RCM_ID){this.product.rcmId=arParams.PRODUCT.RCM_ID;}}if(arParams.OFFERS&&BX.type.isArray(arParams.OFFERS)){this.offers=arParams.OFFERS;this.offerNum=0;if(arParams.OFFER_SELECTED){this.offerNum=parseInt(arParams.OFFER_SELECTED,10);}if(isNaN(this.offerNum)){this.offerNum=0;}if(arParams.TREE_PROPS){this.treeProps=arParams.TREE_PROPS;}if(arParams.DEFAULT_PICTURE){this.defaultPict.pict=arParams.DEFAULT_PICTURE.PICTURE;this.defaultPict.secondPict=arParams.DEFAULT_PICTURE.PICTURE_SECOND;}}break;default:this.errorCode=-1;}if(arParams.BASKET&&typeof arParams.BASKET==='object'){if(arParams.BASKET.QUANTITY){this.basketData.quantity=arParams.BASKET.QUANTITY;}if(arParams.BASKET.PROPS){this.basketData.props=arParams.BASKET.PROPS;}if(arParams.BASKET.BASKET_URL){this.basketData.basketUrl=arParams.BASKET.BASKET_URL;}if(3===this.productType){if(arParams.BASKET.SKU_PROPS){this.basketData.sku_props=arParams.BASKET.SKU_PROPS;}}if(arParams.BASKET.ADD_URL_TEMPLATE){this.basketData.add_url=arParams.BASKET.ADD_URL_TEMPLATE;}if(arParams.BASKET.BUY_URL_TEMPLATE){this.basketData.buy_url=arParams.BASKET.BUY_URL_TEMPLATE;}if(this.basketData.add_url===''&&this.basketData.buy_url===''){this.errorCode=-1024;}}if(this.useCompare){if(arParams.COMPARE&&typeof arParams.COMPARE==='object'){if(arParams.COMPARE.COMPARE_PATH){this.compareData.comparePath=arParams.COMPARE.COMPARE_PATH;}if(arParams.COMPARE.COMPARE_URL_TEMPLATE){this.compareData.compareUrl=arParams.COMPARE.COMPARE_URL_TEMPLATE;}else{this.useCompare=false;}if(arParams.COMPARE.COMPARE_DELETE_URL_TEMPLATE){this.compareData.compareDeleteUrl=arParams.COMPARE.COMPARE_DELETE_URL_TEMPLATE;}else{this.useCompare=false;}}else{this.useCompare=false;}}}if(this.errorCode===0){BX.ready(BX.delegate(this.init,this));}};window.JCCatalogItem.prototype={getEntity:function(parent,entity,additionalFilter){if(!parent||!entity)return null;additionalFilter=additionalFilter||'';return parent.querySelector(additionalFilter+'[data-entity="'+entity+'"]');},init:function(){var i=0,treeItems=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1;}this.obPict=BX(this.visual.PICT_ID);if(!this.obPict){this.errorCode=-2;}if(this.secondPict&&this.visual.SECOND_PICT_ID){this.obSecondPict=BX(this.visual.SECOND_PICT_ID);}this.obPictSlider=BX(this.visual.PICT_SLIDER_ID);this.obPictSliderIndicator=BX(this.visual.PICT_SLIDER_ID+'_indicator');this.obPictSliderProgressBar=BX(this.visual.PICT_SLIDER_ID+'_progress_bar');if(!this.obPictSlider){this.errorCode=-4;}this.obPrice=BX(this.visual.PRICE_ID);this.obPriceOld=BX(this.visual.PRICE_OLD_ID);this.obPriceTotal=BX(this.visual.PRICE_TOTAL_ID);if(!this.obPrice){this.errorCode=-16;}if(this.showQuantity&&this.visual.QUANTITY_ID){this.obQuantity=BX(this.visual.QUANTITY_ID);this.blockNodes.quantity=this.obProduct.querySelector('[data-entity="quantity-block"]');if(!this.isTouchDevice){BX.bind(this.obQuantity,'focus',BX.proxy(this.onFocus,this));BX.bind(this.obQuantity,'blur',BX.proxy(this.onBlur,this));}if(this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID);}if(this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID);}}if(this.visual.QUANTITY_LIMIT&&this.showMaxQuantity!=='N'){this.obQuantityLimit.all=BX(this.visual.QUANTITY_LIMIT);if(this.obQuantityLimit.all){this.obQuantityLimit.value=this.obQuantityLimit.all.querySelector('[data-entity="quantity-limit-value"]');if(!this.obQuantityLimit.value){this.obQuantityLimit.all=null;}}}if(this.productType===3&&this.fullDisplayMode){if(this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256;}}if(this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE);}}this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID);if(this.obBasketActions){if(this.visual.BUY_ID){this.obBuyBtn=BX(this.visual.BUY_ID);}}this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS);if(this.showSubscription){this.obSubscribe=BX(this.visual.SUBSCRIBE_ID);}if(this.showPercent){if(this.visual.DSC_PERC){this.obDscPerc=BX(this.visual.DSC_PERC);}if(this.secondPict&&this.visual.SECOND_DSC_PERC){this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC);}}if(this.showSkuProps){if(this.visual.DISPLAY_PROP_DIV){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV);}}if(this.errorCode===0){if(this.isTouchDevice){BX.bind(this.obPictSlider,'touchstart',BX.proxy(this.touchStartEvent,this));BX.bind(this.obPictSlider,'touchend',BX.proxy(this.touchEndEvent,this));BX.bind(this.obPictSlider,'touchcancel',BX.proxy(this.touchEndEvent,this));}else{if(this.viewMode==='CARD'){}}if(this.bigData){var links=BX.findChildren(this.obProduct,{tag:'a'},true);if(links){for(i in links){if(links.hasOwnProperty(i)){if(links[i].getAttribute('href')==this.product.DETAIL_PAGE_URL){BX.bind(links[i],'click',BX.proxy(this.rememberProductRecommendation,this));}}}}}if(this.showQuantity){if(this.obQuantityUp){BX.bind(this.obQuantityUp,'click',BX.delegate(this.quantityUp,this));}if(this.obQuantityDown){BX.bind(this.obQuantityDown,'click',BX.delegate(this.quantityDown,this));}if(this.obQuantity){BX.bind(this.obQuantity,'change',BX.delegate(this.quantityChange,this));}}switch(this.productType){case 0:case 1:case 2:if(parseInt(this.product.morePhotoCount)>1&&this.obPictSlider){this.initializeSlider();}this.checkQuantityControls();break;case 3:if(this.offers.length>0){treeItems=BX.findChildren(this.obTree,{tagName:'a'},true);if(treeItems&&treeItems.length){for(i=0;i<treeItems.length;i++){BX.bind(treeItems[i],'click',BX.delegate(this.selectOfferProp,this));}}this.setCurrent();}break;}if(!this.alcohol){if(this.obBuyBtn){if(this.basketAction==='ADD'){BX.bind(this.obBuyBtn,'click',BX.proxy(this.add2Basket,this));}else{BX.bind(this.obBuyBtn,'click',BX.proxy(this.buyBasket,this));}}}var page=this.obProduct.querySelector('.c-card-catalog');var page2new=this.obProduct.querySelector('.c-card-catalog-2');if((page)&&typeof(page.dataset.page)!=='undefined'&&page.dataset.page.length>0){var img=page.querySelector('.c-card-catalog__img');var title=page.querySelector('.c-card-catalog__title');var fast=page.querySelector('.show-fast-order');this.ADMIN=true;if($(page).hasClass('v2')&&this.ADMIN){this.dessert=true;$(img).addClass('js-show-cake-order');$(title).addClass('js-show-cake-order');}else{$(img).addClass('js-show-product-order');$(title).addClass('js-show-product-order');}this.detailPage=page.dataset.page;BX.bind(fast,'click',BX.proxy(this.getDetail,this));BX.bind(img,'click',BX.proxy(this.getDetail,this));BX.bind(title,'click',BX.proxy(this.getDetail,this));if(typeof this.show_element!=='undefined'){if(this.show_element&&!window.stopLoadItem){this.detailPage=this.show_element;this.getDetail();setTimeout(function(){$(title).trigger('click');},500);window.stopLoadItem=true;}}}if((page2new)&&typeof(page2new.dataset.page)!=='undefined'&&page2new.dataset.page.length>0){this.version=2;var fast=page2new.querySelector('.show-fast-order');var img=page2new.querySelector('.c-card-catalog-2__img');var title=page2new.querySelector('.c-card-catalog-2__title');this.ADMIN=true;if($(page2new).hasClass('v2')&&this.ADMIN){this.dessert=true;$(img).addClass('js-show-cake-order');$(title).addClass('js-show-cake-order');}else{$(img).addClass('js-show-product-order');$(title).addClass('js-show-product-order');}this.detailPage=page2new.dataset.page;BX.bind(img,'click',BX.proxy(this.getDetail,this));BX.bind(title,'click',BX.proxy(this.getDetail,this));BX.bind(fast,'click',BX.proxy(this.getDetail,this));$(document).on('click','.show-fast-order',function(){$(title).click();})
if(typeof this.show_element!=='undefined'){if(this.show_element&&!window.stopLoadItem){this.detailPage=this.show_element;this.getDetail();setTimeout(function(){$(title).trigger('click');},500);window.stopLoadItem=true;}}}}},getDetail:function(event){var href=this.detailPage,folder=this.folder,dessert=this.dessert;if(dessert)var contentId='menu-item-v2';else
var contentId='menu-item';$('#'+contentId).html(reloadContent);console.log(this.detailPage);BX.ajax({url:this.detailPage,method:'POST',dataType:'html',data:{ajax:'Y',clear_cache:'Y'},onsuccess:function(res){window.history.pushState(null,null,href);this.stopLoadItem=true;BX(contentId).innerHTML=res;localStorage.setItem('backUrl',folder);}});$(document).on('click','.popup-product .popup-close, .popup-cake-order .popup-close',function(){window.history.pushState(null,null,folder);localStorage.removeItem("backUrl");});},setAnalyticsDataLayer:function(action){if(!this.useEnhancedEcommerce||!this.dataLayerName)return;var item={},info={},variants=[],i,k,j,propId,skuId,propValues;switch(this.productType){case 0:case 1:case 2:item={'id':this.product.id,'name':this.product.name,'price':this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,'brand':BX.type.isArray(this.brandProperty)?this.brandProperty.join('/'):this.brandProperty};break;case 3:for(i in this.offers[this.offerNum].TREE){if(this.offers[this.offerNum].TREE.hasOwnProperty(i)){propId=i.substring(5);skuId=this.offers[this.offerNum].TREE[i];for(k in this.treeProps){if(this.treeProps.hasOwnProperty(k)&&this.treeProps[k].ID==propId){for(j in this.treeProps[k].VALUES){propValues=this.treeProps[k].VALUES[j];if(propValues.ID==skuId){variants.push(propValues.NAME);break;}}}}}}item={'id':this.offers[this.offerNum].ID,'name':this.offers[this.offerNum].NAME,'price':this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,'brand':BX.type.isArray(this.brandProperty)?this.brandProperty.join('/'):this.brandProperty,'variant':variants.join('/')};break;}switch(action){case'addToCart':info={'event':'addToCart','ecommerce':{'currencyCode':this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].CURRENCY||'','add':{'products':[{'name':item.name||'','id':item.id||'','price':item.price||0,'brand':item.brand||'','category':item.category||'','variant':item.variant||'','quantity':this.showQuantity&&this.obQuantity?this.obQuantity.value:1}]}}};break;}window[this.dataLayerName]=window[this.dataLayerName]||[];window[this.dataLayerName].push(info);},hoverOn:function(event){clearTimeout(this.hoverTimer);this.obProduct.style.height=getComputedStyle(this.obProduct).height;BX.addClass(this.obProduct,'hover');BX.PreventDefault(event);},hoverOff:function(event){if(this.hoverStateChangeForbidden)return;BX.removeClass(this.obProduct,'hover');this.hoverTimer=setTimeout(BX.delegate(function(){this.obProduct.style.height='auto';},this),300);BX.PreventDefault(event);},onFocus:function(){this.hoverStateChangeForbidden=true;BX.bind(document,'mousemove',BX.proxy(this.captureMousePosition,this));},onBlur:function(){this.hoverStateChangeForbidden=false;BX.unbind(document,'mousemove',BX.proxy(this.captureMousePosition,this));var cursorElement=document.elementFromPoint(this.mouseX,this.mouseY);if(!cursorElement||!this.obProduct.contains(cursorElement)){this.hoverOff();}},captureMousePosition:function(event){this.mouseX=event.clientX;this.mouseY=event.clientY;},getCookie:function(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,'\\$1')+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):null;},rememberProductRecommendation:function(){var cookieName=BX.cookie_prefix+'_RCM_PRODUCT_LOG',cookie=this.getCookie(cookieName),itemFound=false;var cItems=[],cItem;if(cookie){cItems=cookie.split('.');}var i=cItems.length;while(i--){cItem=cItems[i].split('-');if(cItem[0]==this.product.id){cItem=cItems[i].split('-');cItem[1]=this.product.rcmId;cItem[2]=BX.current_server_time;cItems[i]=cItem.join('-');itemFound=true;}else{if((BX.current_server_time-cItem[2])>3600*24*30){cItems.splice(i,1);}}}if(!itemFound){cItems.push([this.product.id,this.product.rcmId,BX.current_server_time].join('-'));}var plNewCookie=cItems.join('.'),cookieDate=new Date(new Date().getTime()+1000*3600*24*365*10).toUTCString();document.cookie=cookieName+"="+plNewCookie+"; path=/; expires="+cookieDate+"; domain="+BX.cookie_domain;},quantityUp:function(){var curValue=0,boolSet=true;if(this.errorCode===0&&this.showQuantity&&this.canBuy){curValue=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(curValue)){curValue+=this.stepQuantity;if(this.checkQuantity){if(curValue>this.maxQuantity){boolSet=false;}}if(boolSet){if(this.isDblQuantity){curValue=Math.round(curValue*this.precisionFactor)/this.precisionFactor;}this.obQuantity.value=curValue;this.setPrice();this.changeQuantity(this.product.id,this.obQuantity.value);}}}},quantityDown:function(){var curValue=0,boolSet=true;if(this.errorCode===0&&this.showQuantity&&this.canBuy){curValue=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(curValue)){curValue-=this.stepQuantity;this.checkPriceRange(curValue);if(curValue<this.minQuantity){boolSet=false;}if(boolSet){if(this.isDblQuantity){curValue=Math.round(curValue*this.precisionFactor)/this.precisionFactor;}this.obQuantity.value=curValue;this.setPrice();this.changeQuantity(this.product.id,this.obQuantity.value,"-");}else{if(curValue==0){if(this.isDblQuantity){curValue=Math.round(curValue*this.precisionFactor)/this.precisionFactor;}this.obQuantity.value=curValue;this.setPrice();this.changeQuantity(this.product.id,this.obQuantity.value,"-");this.deleteBasket(this.product.id);}}}}},quantityChange:function(){var curValue=0,intCount;if(this.errorCode===0&&this.showQuantity){if(this.canBuy){curValue=this.isDblQuantity?parseFloat(this.obQuantity.value):Math.round(this.obQuantity.value);if(!isNaN(curValue)){if(this.checkQuantity){if(curValue>this.maxQuantity){curValue=this.maxQuantity;}}this.checkPriceRange(curValue);if(curValue<this.minQuantity){curValue=this.minQuantity;}else{intCount=Math.round(Math.round(curValue*this.precisionFactor/this.stepQuantity)/this.precisionFactor)||1;curValue=(intCount<=1?this.stepQuantity:intCount*this.stepQuantity);curValue=Math.round(curValue*this.precisionFactor)/this.precisionFactor;}this.obQuantity.value=curValue;}else{this.obQuantity.value=this.minQuantity;}}else{this.obQuantity.value=this.minQuantity;}this.setPrice();this.changeQuantity(this.product.id,this.obQuantity.value);}},quantitySet:function(index){var resetQuantity,strLimit;var newOffer=this.offers[index],oldOffer=this.offers[this.offerNum];if(this.errorCode===0){this.canBuy=newOffer.CAN_BUY;this.currentPriceMode=newOffer.ITEM_PRICE_MODE;this.currentPrices=newOffer.ITEM_PRICES;this.currentPriceSelected=newOffer.ITEM_PRICE_SELECTED;this.currentQuantityRanges=newOffer.ITEM_QUANTITY_RANGES;this.currentQuantityRangeSelected=newOffer.ITEM_QUANTITY_RANGE_SELECTED;if(this.canBuy){if(this.blockNodes.quantity){BX.style(this.blockNodes.quantity,'display','');}if(this.obBasketActions){BX.style(this.obBasketActions,'display','');}if(this.obNotAvail){BX.style(this.obNotAvail,'display','none');}if(this.obSubscribe){BX.style(this.obSubscribe,'display','none');}}else{if(this.blockNodes.quantity){BX.style(this.blockNodes.quantity,'display','none');}if(this.obBasketActions){BX.style(this.obBasketActions,'display','none');}if(this.obNotAvail){BX.style(this.obNotAvail,'display','');}if(this.obSubscribe){if(newOffer.CATALOG_SUBSCRIBE==='Y'){BX.style(this.obSubscribe,'display','');this.obSubscribe.setAttribute('data-item',newOffer.ID);BX(this.visual.SUBSCRIBE_ID+'_hidden').click();}else{BX.style(this.obSubscribe,'display','none');}}}this.isDblQuantity=newOffer.QUANTITY_FLOAT;this.checkQuantity=newOffer.CHECK_QUANTITY;if(this.isDblQuantity){this.stepQuantity=Math.round(parseFloat(newOffer.STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor;this.maxQuantity=parseFloat(newOffer.MAX_QUANTITY);this.minQuantity=this.currentPriceMode==='Q'?parseFloat(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity;}else{this.stepQuantity=parseInt(newOffer.STEP_QUANTITY,10);this.maxQuantity=parseInt(newOffer.MAX_QUANTITY,10);this.minQuantity=this.currentPriceMode==='Q'?parseInt(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity;}if(this.showQuantity){var isDifferentMinQuantity=oldOffer.ITEM_PRICES.length&&oldOffer.ITEM_PRICES[oldOffer.ITEM_PRICE_SELECTED]&&oldOffer.ITEM_PRICES[oldOffer.ITEM_PRICE_SELECTED].MIN_QUANTITY!=this.minQuantity;if(this.isDblQuantity){resetQuantity=Math.round(parseFloat(oldOffer.STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor!==this.stepQuantity||isDifferentMinQuantity||oldOffer.MEASURE!==newOffer.MEASURE||(this.checkQuantity&&parseFloat(oldOffer.MAX_QUANTITY)>this.maxQuantity&&parseFloat(this.obQuantity.value)>this.maxQuantity);}else{resetQuantity=parseInt(oldOffer.STEP_QUANTITY,10)!==this.stepQuantity||isDifferentMinQuantity||oldOffer.MEASURE!==newOffer.MEASURE||(this.checkQuantity&&parseInt(oldOffer.MAX_QUANTITY,10)>this.maxQuantity&&parseInt(this.obQuantity.value,10)>this.maxQuantity);}this.obQuantity.disabled=!this.canBuy;if(resetQuantity){this.obQuantity.value=this.minQuantity;}if(this.obMeasure){if(newOffer.MEASURE){BX.adjust(this.obMeasure,{html:newOffer.MEASURE});}else{BX.adjust(this.obMeasure,{html:''});}}}if(this.obQuantityLimit.all){if(!this.checkQuantity||this.maxQuantity==0){BX.adjust(this.obQuantityLimit.value,{html:''});BX.adjust(this.obQuantityLimit.all,{style:{display:'none'}});}else{if(this.showMaxQuantity==='M'){strLimit=(this.maxQuantity/this.stepQuantity>=this.relativeQuantityFactor)?BX.message('RELATIVE_QUANTITY_MANY'):BX.message('RELATIVE_QUANTITY_FEW');}else{strLimit=this.maxQuantity;if(newOffer.MEASURE){strLimit+=(' '+newOffer.MEASURE);}}BX.adjust(this.obQuantityLimit.value,{html:strLimit});BX.adjust(this.obQuantityLimit.all,{style:{display:''}});}}}},initializeSlider:function(){var wrap=this.obPictSlider.getAttribute('data-slider-wrap');if(wrap){this.slider.options.wrap=wrap==='true';}else{this.slider.options.wrap=this.defaultSliderOptions.wrap;}if(this.isTouchDevice){this.slider.options.interval=false;}else{this.slider.options.interval=parseInt(this.obPictSlider.getAttribute('data-slider-interval'))||this.defaultSliderOptions.interval;if(this.slider.options.interval<700){this.slider.options.interval=700;}if(this.obPictSliderIndicator){var controls=this.obPictSliderIndicator.querySelectorAll('[data-go-to]');for(var i in controls){if(controls.hasOwnProperty(i)){BX.bind(controls[i],'click',BX.proxy(this.sliderClickHandler,this));}}}if(this.obPictSliderProgressBar){if(this.slider.progress){this.resetProgress();this.cycleSlider();}else{this.slider.progress=new BX.easing({transition:BX.easing.transitions.linear,step:BX.delegate(function(state){this.obPictSliderProgressBar.style.width=state.width/10+'%';},this)});}}}},checkTouch:function(event){if(!event||!event.changedTouches)return false;return event.changedTouches[0].identifier===this.touch.identifier;},touchStartEvent:function(event){if(event.touches.length!=1)return;this.touch=event.changedTouches[0];},touchEndEvent:function(event){if(!this.checkTouch(event))return;var deltaX=this.touch.pageX-event.changedTouches[0].pageX,deltaY=this.touch.pageY-event.changedTouches[0].pageY;if(Math.abs(deltaX)>=Math.abs(deltaY)+10){if(deltaX>0){this.slideNext();}if(deltaX<0){this.slidePrev();}}},sliderClickHandler:function(event){var target=BX.getEventTarget(event),slideIndex=target.getAttribute('data-go-to');if(slideIndex){this.slideTo(slideIndex)}BX.PreventDefault(event);},slideNext:function(){if(this.slider.sliding)return;return this.slide('next');},slidePrev:function(){if(this.slider.sliding)return;return this.slide('prev');},slideTo:function(pos){this.slider.active=BX.findChild(this.obPictSlider,{className:'item active'},true,false);this.slider.progress&&(this.slider.interval=true);var activeIndex=this.getItemIndex(this.slider.active);if(pos>(this.slider.items.length-1)||pos<0)return;if(this.slider.sliding)return false;if(activeIndex==pos){this.stopSlider();this.cycleSlider();return;}return this.slide(pos>activeIndex?'next':'prev',this.eq(this.slider.items,pos));},slide:function(type,next){var active=BX.findChild(this.obPictSlider,{className:'item active'},true,false),isCycling=this.slider.interval,direction=type==='next'?'left':'right';next=next||this.getItemForDirection(type,active);if(BX.hasClass(next,'active')){return(this.slider.sliding=false);}this.slider.sliding=true;isCycling&&this.stopSlider();if(this.obPictSliderIndicator){BX.removeClass(this.obPictSliderIndicator.querySelector('.active'),'active');var nextIndicator=this.obPictSliderIndicator.querySelectorAll('[data-go-to]')[this.getItemIndex(next)];nextIndicator&&BX.addClass(nextIndicator,'active');}if(BX.hasClass(this.obPictSlider,'slide')&&!BX.browser.IsIE()){var self=this;BX.addClass(next,type);next.offsetWidth;BX.addClass(active,direction);BX.addClass(next,direction);setTimeout(function(){BX.addClass(next,'active');BX.removeClass(active,'active');BX.removeClass(active,direction);BX.removeClass(next,type);BX.removeClass(next,direction);self.slider.sliding=false;},700);}else{BX.addClass(next,'active');this.slider.sliding=false;}this.obPictSliderProgressBar&&this.resetProgress();isCycling&&this.cycleSlider();},stopSlider:function(event){event||(this.slider.paused=true);this.slider.interval&&clearInterval(this.slider.interval);if(this.slider.progress){this.slider.progress.stop();var width=parseInt(this.obPictSliderProgressBar.style.width);this.slider.progress.options.duration=this.slider.options.interval*width/200;this.slider.progress.options.start={width:width*10};this.slider.progress.options.finish={width:0};this.slider.progress.options.complete=null;this.slider.progress.animate();}},cycleSlider:function(event){event||(this.slider.paused=false);this.slider.interval&&clearInterval(this.slider.interval);if(this.slider.options.interval&&!this.slider.paused){if(this.slider.progress){this.slider.progress.stop();var width=parseInt(this.obPictSliderProgressBar.style.width);this.slider.progress.options.duration=this.slider.options.interval*(100-width)/100;this.slider.progress.options.start={width:width*10};this.slider.progress.options.finish={width:1000};this.slider.progress.options.complete=BX.delegate(function(){this.slider.interval=true;this.slideNext();},this);this.slider.progress.animate();}else{this.slider.interval=setInterval(BX.proxy(this.slideNext,this),this.slider.options.interval);}}},resetProgress:function(){this.slider.progress&&this.slider.progress.stop();this.obPictSliderProgressBar.style.width=0;},getItemForDirection:function(direction,active){var activeIndex=this.getItemIndex(active),willWrap=direction==='prev'&&activeIndex===0||direction==='next'&&activeIndex==(this.slider.items.length-1);if(willWrap&&!this.slider.options.wrap)return active;var delta=direction==='prev'?-1:1,itemIndex=(activeIndex+delta)%this.slider.items.length;return this.eq(this.slider.items,itemIndex);},getItemIndex:function(item){this.slider.items=BX.findChildren(item.parentNode,{className:'item'},true);return this.slider.items.indexOf(item||this.slider.active);},eq:function(obj,i){var len=obj.length,j=+i+(i<0?len:0);return j>=0&&j<len?obj[j]:{};},selectOfferProp:function(){var i=0,value='',strTreeValue='',arTreeItem=[],rowItems=null,target=BX.proxy_context;if(target&&target.hasAttribute('data-treevalue')){if(BX.hasClass(target,'selected'))return;strTreeValue=target.getAttribute('data-treevalue');arTreeItem=strTreeValue.split('_');if(this.searchOfferPropIndex(arTreeItem[0],arTreeItem[1])){rowItems=BX.findChildren(target.parentNode,{tagName:'a'},false);if(rowItems&&0<rowItems.length){for(i=0;i<rowItems.length;i++){value=rowItems[i].getAttribute('data-onevalue');if(value===arTreeItem[1]){BX.addClass(rowItems[i],'selected');}else{BX.removeClass(rowItems[i],'selected');}}}}}},searchOfferPropIndex:function(strPropID,strPropValue){var strName='',arShowValues=false,i,j,arCanBuyValues=[],allValues=[],index=-1,arFilter={},tmpFilter=[];for(i=0;i<this.treeProps.length;i++){if(this.treeProps[i].ID===strPropID){index=i;break;}}if(-1<index){for(i=0;i<index;i++){strName='PROP_'+this.treeProps[i].ID;arFilter[strName]=this.selectedValues[strName];}strName='PROP_'+this.treeProps[index].ID;arShowValues=this.getRowValues(arFilter,strName);if(!arShowValues){return false;}if(!BX.util.in_array(strPropValue,arShowValues)){return false;}arFilter[strName]=strPropValue;for(i=index+1;i<this.treeProps.length;i++){strName='PROP_'+this.treeProps[i].ID;arShowValues=this.getRowValues(arFilter,strName);if(!arShowValues){return false;}allValues=[];if(this.showAbsent){arCanBuyValues=[];tmpFilter=[];tmpFilter=BX.clone(arFilter,true);for(j=0;j<arShowValues.length;j++){tmpFilter[strName]=arShowValues[j];allValues[allValues.length]=arShowValues[j];if(this.getCanBuy(tmpFilter))arCanBuyValues[arCanBuyValues.length]=arShowValues[j];}}else{arCanBuyValues=arShowValues;}if(this.selectedValues[strName]&&BX.util.in_array(this.selectedValues[strName],arCanBuyValues)){arFilter[strName]=this.selectedValues[strName];}else{if(this.showAbsent)arFilter[strName]=(arCanBuyValues.length>0?arCanBuyValues[0]:allValues[0]);else
arFilter[strName]=arCanBuyValues[0];}this.updateRow(i,arFilter[strName],arShowValues,arCanBuyValues);}this.selectedValues=arFilter;this.changeInfo();}return true;},updateRow:function(intNumber,activeID,showID,canBuyID){var i=0,value='',isCurrent=false,rowItems=null;var lineContainer=this.obTree.querySelectorAll('[data-entity="sku-line-block"]'),listContainer;if(intNumber>-1&&intNumber<lineContainer.length){listContainer=lineContainer[intNumber].querySelector('.c-card-catalog__ingredients');rowItems=BX.findChildren(listContainer,{tagName:'a'},false);if(rowItems&&0<rowItems.length){for(i=0;i<rowItems.length;i++){value=rowItems[i].getAttribute('data-onevalue');isCurrent=value===activeID;if(isCurrent){BX.addClass(rowItems[i],'selected');}else{BX.removeClass(rowItems[i],'selected');}if(BX.util.in_array(value,canBuyID)){BX.removeClass(rowItems[i],'notallowed');}else{BX.addClass(rowItems[i],'notallowed');}rowItems[i].style.display=BX.util.in_array(value,showID)?'':'none';if(isCurrent){lineContainer[intNumber].style.display=(value==0&&canBuyID.length==1)?'none':'';}}}}},getRowValues:function(arFilter,index){var i=0,j,arValues=[],boolSearch=false,boolOneSearch=true;if(0===arFilter.length){for(i=0;i<this.offers.length;i++){if(!BX.util.in_array(this.offers[i].TREE[index],arValues)){arValues[arValues.length]=this.offers[i].TREE[index];}}boolSearch=true;}else{for(i=0;i<this.offers.length;i++){boolOneSearch=true;for(j in arFilter){if(arFilter[j]!==this.offers[i].TREE[j]){boolOneSearch=false;break;}}if(boolOneSearch){if(!BX.util.in_array(this.offers[i].TREE[index],arValues)){arValues[arValues.length]=this.offers[i].TREE[index];}boolSearch=true;}}}return(boolSearch?arValues:false);},getCanBuy:function(arFilter){var i,j,boolSearch=false,boolOneSearch=true;for(i=0;i<this.offers.length;i++){boolOneSearch=true;for(j in arFilter){if(arFilter[j]!==this.offers[i].TREE[j]){boolOneSearch=false;break;}}if(boolOneSearch){if(this.offers[i].CAN_BUY){boolSearch=true;break;}}}return boolSearch;},setCurrent:function(){var i,j=0,arCanBuyValues=[],strName='',arShowValues=false,arFilter={},tmpFilter=[],current=this.offers[this.offerNum].TREE;for(i=0;i<this.treeProps.length;i++){strName='PROP_'+this.treeProps[i].ID;arShowValues=this.getRowValues(arFilter,strName);if(!arShowValues){break;}if(BX.util.in_array(current[strName],arShowValues)){arFilter[strName]=current[strName];}else{arFilter[strName]=arShowValues[0];this.offerNum=0;}if(this.showAbsent){arCanBuyValues=[];tmpFilter=[];tmpFilter=BX.clone(arFilter,true);for(j=0;j<arShowValues.length;j++){tmpFilter[strName]=arShowValues[j];if(this.getCanBuy(tmpFilter)){arCanBuyValues[arCanBuyValues.length]=arShowValues[j];}}}else{arCanBuyValues=arShowValues;}this.updateRow(i,arFilter[strName],arShowValues,arCanBuyValues);}this.selectedValues=arFilter;this.changeInfo();},changeInfo:function(){var i,j,index=-1,boolOneSearch=true,quantityChanged;for(i=0;i<this.offers.length;i++){boolOneSearch=true;for(j in this.selectedValues){if(this.selectedValues[j]!==this.offers[i].TREE[j]){boolOneSearch=false;break;}}if(boolOneSearch){index=i;break;}}if(index>-1){if(this.showSkuProps&&this.obSkuProps){if(this.offers[index].DISPLAY_PROPERTIES.length){BX.adjust(this.obSkuProps,{style:{display:''},html:this.offers[index].DISPLAY_PROPERTIES});}else{BX.adjust(this.obSkuProps,{style:{display:'none'},html:''});}}var imageCont=this.getEntity(this.obProduct,'images-container');var weightCont=this.getEntity(this.obProduct,'product-weight');if(weightCont)weightCont.innerHTML=': '+this.offers[index].WEIGHT+' '+this.offers[index].MEASURE;$(imageCont).find('img').attr('src',this.offers[index].PREVIEW_PICTURE_SECOND.SRC);this.quantitySet(index);this.setPrice();if(typeof this.lastQuantity[this.offers[index].ID]==='undefined'||typeof this.lastQuantity[this.offers[index].ID]==='null')this.lastQuantity[this.offers[index].ID]=1;if(this.obQuantity)this.obQuantity.value=this.lastQuantity[this.offers[index].ID];this.product.id=this.offers[index].ID;this.offerNum=index;}},checkPriceRange:function(quantity){if(typeof quantity==='undefined'||this.currentPriceMode!='Q')return;var range,found=false;for(var i in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(i)){range=this.currentQuantityRanges[i];if(parseInt(quantity)>=parseInt(range.SORT_FROM)&&(range.SORT_TO=='INF'||parseInt(quantity)<=parseInt(range.SORT_TO))){found=true;this.currentQuantityRangeSelected=range.HASH;break;}}}if(!found&&(range=this.getMinPriceRange())){this.currentQuantityRangeSelected=range.HASH;}for(var k in this.currentPrices){if(this.currentPrices.hasOwnProperty(k)){if(this.currentPrices[k].QUANTITY_HASH==this.currentQuantityRangeSelected){this.currentPriceSelected=k;break;}}}},getMinPriceRange:function(){var range;for(var i in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(i)){if(!range||parseInt(this.currentQuantityRanges[i].SORT_FROM)<parseInt(range.SORT_FROM)){range=this.currentQuantityRanges[i];}}}return range;},checkQuantityControls:function(){if(!this.obQuantity)return;var reachedTopLimit=this.checkQuantity&&parseFloat(this.obQuantity.value)+this.stepQuantity>this.maxQuantity,reachedBottomLimit=parseFloat(this.obQuantity.value)-this.stepQuantity<this.minQuantity;if(reachedTopLimit){BX.addClass(this.obQuantityUp,'product-item-amount-field-btn-disabled');}else if(BX.hasClass(this.obQuantityUp,'product-item-amount-field-btn-disabled')){BX.removeClass(this.obQuantityUp,'product-item-amount-field-btn-disabled');}if(reachedBottomLimit){BX.addClass(this.obQuantityDown,'product-item-amount-field-btn-disabled');}else if(BX.hasClass(this.obQuantityDown,'product-item-amount-field-btn-disabled')){BX.removeClass(this.obQuantityDown,'product-item-amount-field-btn-disabled');}if(reachedTopLimit&&reachedBottomLimit){this.obQuantity.setAttribute('disabled','disabled');}else{this.obQuantity.removeAttribute('disabled');}},setPrice:function(){var obData,price;if(this.obQuantity){this.checkPriceRange(this.obQuantity.value);}this.checkQuantityControls();price=this.currentPrices[this.currentPriceSelected];if(this.obPrice){if(price){BX.adjust(this.obPrice,{html:price.PRINT_RATIO_PRICE});}else{BX.adjust(this.obPrice,{html:''});}if(this.showOldPrice&&this.obPriceOld){if(price&&price.RATIO_PRICE!==price.RATIO_BASE_PRICE){BX.adjust(this.obPriceOld,{style:{display:''},html:BX.Currency.currencyFormat(price.RATIO_BASE_PRICE,price.CURRENCY,true)});}else{BX.adjust(this.obPriceOld,{style:{display:'none'},html:''});}}if(this.obPriceTotal){if(price&&this.obQuantity&&this.obQuantity.value!=this.stepQuantity){BX.adjust(this.obPriceTotal,{html:BX.message('PRICE_TOTAL_PREFIX')+' <strong>'+BX.Currency.currencyFormat(price.PRICE*this.obQuantity.value,price.CURRENCY,true)+'</strong>',style:{display:''}});}else{BX.adjust(this.obPriceTotal,{html:'',style:{display:'none'}});}}if(this.showPercent){if(price&&parseInt(price.DISCOUNT)>0){obData={style:{display:''},html:-price.PERCENT+'%'};}else{obData={style:{display:'none'},html:''};}if(this.obDscPerc){BX.adjust(this.obDscPerc,obData);}if(this.obSecondDscPerc){BX.adjust(this.obSecondDscPerc,obData);}}}},compare:function(event){var checkbox=this.obCompare.querySelector('[data-entity="compare-checkbox"]'),target=BX.getEventTarget(event),checked=true;if(checkbox){checked=target===checkbox?checkbox.checked:!checkbox.checked;}var url=checked?this.compareData.compareUrl:this.compareData.compareDeleteUrl,compareLink;if(url){if(target!==checkbox){BX.PreventDefault(event);this.setCompared(checked);}switch(this.productType){case 0:case 1:case 2:compareLink=url.replace('#ID#',this.product.id.toString());break;case 3:compareLink=url.replace('#ID#',this.offers[this.offerNum].ID);break;}BX.ajax({method:'POST',dataType:checked?'json':'html',url:compareLink+(compareLink.indexOf('?')!==-1?'&':'?')+'ajax_action=Y',onsuccess:checked?BX.proxy(this.compareResult,this):BX.proxy(this.compareDeleteResult,this)});}},compareResult:function(result){var popupContent,popupButtons;if(this.obPopupWin){this.obPopupWin.close();}if(!BX.type.isPlainObject(result))return;this.initPopupWindow();if(this.offers.length>0){this.offers[this.offerNum].COMPARED=result.STATUS==='OK';}if(result.STATUS==='OK'){BX.onCustomEvent('OnCompareChange');popupContent='<div style="width: 100%; margin: 0; text-align: center;"><p>'+BX.message('COMPARE_MESSAGE_OK')+'</p></div>';if(this.showClosePopup){popupButtons=[new BasketButton({text:BX.message('BTN_MESSAGE_COMPARE_REDIRECT'),events:{click:BX.delegate(this.compareRedirect,this)},style:{marginRight:'10px'}}),new BasketButton({text:BX.message('BTN_MESSAGE_CLOSE_POPUP'),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})];}else{popupButtons=[new BasketButton({text:BX.message('BTN_MESSAGE_COMPARE_REDIRECT'),events:{click:BX.delegate(this.compareRedirect,this)}})];}}else{popupContent='<div style="width: 100%; margin: 0; text-align: center;"><p>'+(result.MESSAGE?result.MESSAGE:BX.message('COMPARE_UNKNOWN_ERROR'))+'</p></div>';popupButtons=[new BasketButton({text:BX.message('BTN_MESSAGE_CLOSE'),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})];}this.obPopupWin.setTitleBar(BX.message('COMPARE_TITLE'));this.obPopupWin.setContent(popupContent);this.obPopupWin.setButtons(popupButtons);this.obPopupWin.show();},compareDeleteResult:function(){BX.onCustomEvent('OnCompareChange');if(this.offers&&this.offers.length){this.offers[this.offerNum].COMPARED=false;}},setCompared:function(state){if(!this.obCompare)return;var checkbox=this.obCompare.querySelector('[data-entity="compare-checkbox"]');if(checkbox){checkbox.checked=state;}},setCompareInfo:function(comparedIds){if(!BX.type.isArray(comparedIds))return;for(var i in this.offers){if(this.offers.hasOwnProperty(i)){this.offers[i].COMPARED=BX.util.in_array(this.offers[i].ID,comparedIds);}}},compareRedirect:function(){if(this.compareData.comparePath){location.href=this.compareData.comparePath;}else{this.obPopupWin.close();}},checkDeletedCompare:function(id){switch(this.productType){case 0:case 1:case 2:if(this.product.id==id){this.setCompared(false);}break;case 3:var i=this.offers.length;while(i--){if(this.offers[i].ID==id){this.offers[i].COMPARED=false;if(this.offerNum==i){this.setCompared(false);}break;}}}},initBasketUrl:function(){this.basketUrl=(this.basketMode==='ADD'?this.basketData.add_url:this.basketData.buy_url);switch(this.productType){case 1:case 2:this.basketUrl=this.basketUrl.replace('#ID#',this.product.id.toString());break;case 3:this.basketUrl=this.basketUrl.replace('#ID#',this.offers[this.offerNum].ID);break;}this.basketParams={'ajax_basket':'Y'};if(this.showQuantity){this.basketParams[this.basketData.quantity]=this.obQuantity.value;}if(this.basketData.sku_props){this.basketParams[this.basketData.sku_props_var]=this.basketData.sku_props;}},fillBasketProps:function(){if(!this.visual.BASKET_PROP_DIV){return;}var
i=0,propCollection=null,foundValues=false,obBasketProps=null;if(this.basketData.useProps&&!this.basketData.emptyProps){if(this.obPopupWin&&this.obPopupWin.contentContainer){obBasketProps=this.obPopupWin.contentContainer;}}else{obBasketProps=BX(this.visual.BASKET_PROP_DIV);}if(obBasketProps){propCollection=obBasketProps.getElementsByTagName('select');if(propCollection&&propCollection.length){for(i=0;i<propCollection.length;i++){if(!propCollection[i].disabled){switch(propCollection[i].type.toLowerCase()){case'select-one':this.basketParams[propCollection[i].name]=propCollection[i].value;foundValues=true;break;default:break;}}}}propCollection=obBasketProps.getElementsByTagName('input');if(propCollection&&propCollection.length){for(i=0;i<propCollection.length;i++){if(!propCollection[i].disabled){switch(propCollection[i].type.toLowerCase()){case'hidden':this.basketParams[propCollection[i].name]=propCollection[i].value;foundValues=true;break;case'radio':if(propCollection[i].checked){this.basketParams[propCollection[i].name]=propCollection[i].value;foundValues=true;}break;default:break;}}}}}if(!foundValues){this.basketParams[this.basketData.props]=[];this.basketParams[this.basketData.props][0]=0;}},add2Basket:function(){this.basketMode='ADD';var itemCard=$(this.obProduct).find('.c-card-catalog__img img'),basketIcon=$('.header-basket');if(this.version==2){var itemCard=$(this.obProduct).find('.c-card-catalog-2__img'),basketIcon=$('.header-basket');}$(this.obProduct).find('.fieldCount').val(parseInt($(this.obProduct).find('.fieldCount').val())+1);flyToElement(itemCard,basketIcon);this.basket();},buyBasket:function(){$(this.obBuyBtn).show();this.basketMode='BUY';this.basket();},sendToBasket:function(){if(!this.canBuy){return;}if(this.product&&this.product.id&&this.bigData){this.rememberProductRecommendation();}this.initBasketUrl();this.fillBasketProps();$(this.obBuyBtn).show();console.log(this.basketParams);var basketParams=Object.assign(this.basketParams);basketParams.quantity=1;BX.ajax({method:'POST',dataType:'json',url:this.basketUrl,data:basketParams,onsuccess:BX.proxy(this.basketResult,this)});},basket:function(){var contentBasketProps='';if(!this.canBuy){return;}switch(this.productType){case 1:case 2:if(this.basketData.useProps&&!this.basketData.emptyProps){this.initPopupWindow();this.obPopupWin.setTitleBar(BX.message('TITLE_BASKET_PROPS'));if(BX(this.visual.BASKET_PROP_DIV)){contentBasketProps=BX(this.visual.BASKET_PROP_DIV).innerHTML;}this.obPopupWin.setContent(contentBasketProps);this.obPopupWin.setButtons([new BasketButton({text:BX.message('BTN_MESSAGE_SEND_PROPS'),events:{click:BX.delegate(this.sendToBasket,this)}})]);this.obPopupWin.show();}else{this.sendToBasket();}break;case 3:this.sendToBasket();break;}},basketResult:function(arResult){var strContent='',strPict='',successful,buttons=[];if(this.obPopupWin)this.obPopupWin.close();if(!BX.type.isPlainObject(arResult))return;successful=arResult.STATUS==='OK';if(successful){this.setAnalyticsDataLayer('addToCart');}if(successful&&this.basketAction==='BUY'){this.basketRedirect();}else{var name=this.product.name;$(this.obBuyBtn).find('i').tooltipster({content:name+'    <a href="/personal/cart/"></a>',contentAsHTML:true,maxWidth:500,trigger:'click',interactive:true,triggerOpen:{mouseenter:true,touchstart:true},triggerClose:{mouseleave:true,click:true,scroll:true,tap:true}}).click(function(){var $this=$(this);$this.tooltipster('show');setTimeout(function(){$this.tooltipster('hide');},3000);});BX.onCustomEvent('OnBasketChange');BX.unbind(this.obBuyBtn,'click',BX.proxy(this.add2Basket,this));$(this.obBuyBtn).find('i').trigger('click');BX.bind(this.obBuyBtn,'click',BX.proxy(this.add2Basket,this));$(this.obBuyBtn).show();setTimeout(function(){$(this.obBuyBtn).show();},500);var item={},variants=[],i,k,j,propId,skuId,propValues;switch(this.productType){case 0:case 1:case 2:var item={'id':this.product.id,'name':this.product.name,'category':this.product.category,'price':this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,'quantity':this.obQuantity.value,'brand':""};break;case 3:for(i in this.offers[this.offerNum].TREE){if(this.offers[this.offerNum].TREE.hasOwnProperty(i)){propId=i.substring(5);skuId=this.offers[this.offerNum].TREE[i];for(k in this.treeProps){if(this.treeProps.hasOwnProperty(k)&&this.treeProps[k].ID==propId){for(j in this.treeProps[k].VALUES){propValues=this.treeProps[k].VALUES[j];if(propValues.ID==skuId){variants.push(propValues.NAME);break;}}}}}}var item={'id':this.offers[this.offerNum].MAIN_ITEM,'name':this.offers[this.offerNum].NAME,'category':this.offers[this.offerNum].CATEGORY,'price':this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,'brand':"",'quantity':this.obQuantity.value,'variant':variants.join('/')};break;}setAnalytics(item,'add');}},basketRedirect:function(){location.href=(this.basketData.basketUrl?this.basketData.basketUrl:BX.message('BASKET_URL'));},initPopupWindow:function(){if(this.obPopupWin)return;this.obPopupWin=BX.PopupWindowManager.create('CatalogSectionBasket_'+this.visual.ID,null,{autoHide:true,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:true,contentColor:'white',className:this.templateTheme?'bx-'+this.templateTheme:''});},changeQuantity:function(id,q,action){if(action!="-"){this.flyToBasket();}var self=this;$.ajax({url:'/local/ajax/add_to_cart.php',method:'POST',data:{product:id,action:'update',quantity:q},success:function(res){self.lastQuantity[id]=q;BX.onCustomEvent('OnBasketChange');}});},flyToBasket:function(){var itemCard=$("#"+this.obPict.id),basketIcon=$('.header-basket');flyToElement(itemCard,basketIcon);},deleteBasket:function(id){$.ajax({url:'/local/ajax/add_to_cart.php',method:'POST',data:{product:id,action:'delete'},success:function(res){BX.onCustomEvent('OnBasketChange');}});}};})(window);$(document).ready(function(){$('.fieldCount__catalog').each(function(_,item){var header_input=$('.fieldCount__header[data-item-id="'+$(item).data('item-id')+'"');if(header_input.length>0){$(item).val($(header_input).val());}else{$(item).val(0);}});});;;;